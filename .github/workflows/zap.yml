name: Check run

on:
  push:
    branches:
      - main
    paths-ignore:
      - '**.md'
  pull_request:
    paths-ignore:
      - '**.md'
  workflow_dispatch:

jobs:
  check-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Java
        uses: actions/setup-java@v2
        with:
          distribution: 'adopt'
          java-version: '11'

      - name: Start ZAP Proxy
        run: |
          wget https://github.com/zaproxy/zaproxy/releases/download/2.13.0/ZAP_2.13.0_Linux.tar.gz
          tar -xvzf ZAP_2.13.0_Linux.tar.gz
          cd ZAP_2.13.0
          ./zap.sh -daemon -config api.disablekey=true

      - name: Run ZAP Security Scan
        run: |
          ./ZAP_2.13.0/zap-cli.py --zap-url http://localhost -p 8090 status -t 120
          ./ZAP_2.13.0/zap-cli.py --zap-url http://localhost -p 8090 open-url https://github.com/RachithaMachaiah/node-login
          ./ZAP_2.13.0/zap-cli.py --zap-url http://localhost -p 8090 spider https://github.com/RachithaMachaiah/node-login
          ./ZAP_2.13.0/zap-cli.py --zap-url http://localhost -p 8090 active-scan https://github.com/RachithaMachaiah/node-login
